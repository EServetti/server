<div class="main">
  <h1 style="color:white; border-bottom: 1px solid white; padding-bottom:10px; display:flex; justify-content:center">Our products</h1>
  <div class="formCont">
    <h3 style="color:white; display:flex; justify-content:center">Add a product</h3>
    <form
      class="form"
      style="display: flex; justify-content:center; flex-direction: column; align-items:center "
      id="productForm"
    >
      <input type="text" class="text" id="photo" style="width: 300px;" placeholder="Url of the Image">
      <input
        class="title"
        type="text"
        name="title"
        id="title"
        placeholder="Name of the product "
        style="width: 300px;"
      />
      <input
        class="category"
        type="text"
        name="category"
        id="category"
        placeholder="Category of the product (optional)"
        style="width: 300px;"
      />
      <input
        class="price"
        type="number"
        name="price"
        id="price"
        placeholder="Price of the product (optional)"
        style="width: 300px;"
      />
      <input
        class="stock"
        type="number"
        name="stock"
        id="stock"
        placeholder="Stock of the product (optional)"
        style="width: 300px;"
      />
      <input
        class="create"
        type="submit"
        name="create"
        id="create"
        value="Create"
        style="align-self: center; margin-top:5px; cursor:pointer;  padding: 10px 20px;  border-radius: 5px;  border: none; "
      />
    </form>
  </div>
  <div
    class="mainCont"
    id="product"
    style="margin: 30px 0 0 0; display: flex; flex-wrap: wrap; justify-content:center "
  >
  </div>
</div>
<script>
  //actualiza el input del archivo con el nombre del mismo
  document.getElementById('photo').addEventListener('change', function (e) {
        let fileName = e.target.files[0].name;
        let nextSibling = e.target.nextElementSibling;
        
      //En el caso de que el nombre del archivo sea demasiado largo lo limita a 17 caracteres
       if (fileName.length > 20) {
            fileName = fileName.slice(0, 17) + '...'; 
        }
      nextSibling.innerText = fileName;
   });
</script>
<script src="/socket.io/socket.io.js"></script>
<script>
 
const socket = io(); 

  //recibe los products y los agrega al div con id: product, con un formato estilizado
  socket.on("products", data => { const content =
  data.map(each => ` <div class="productCont" style="background-color:white;
  width:350px; padding: 0 10px 0 10px; margin: 10px 30px 10px 30px; border: 1px
  solid black;"> <img src="${each.photo}" class="productImage" style="width:
  300px; height: 300px;"> <div class="productInfo" style="display: flex;
  justify-content:center; flex-direction:column; align-items: center;"> <h5 style="margin-right: 5px;">${each.title}</h5>
  <h5>$${each.price}</h5><h6>id:${each._id}</h6></div> </div>`).reverse().join("");
  document.querySelector("#product").innerHTML = content; });
//envia los datos del producto

document.querySelector("#productForm").addEventListener("submit", async (event) => {
    event.preventDefault(); 

    const title = document.querySelector("#title").value;
    let photo = document.querySelector("#photo").value;
    let category = document.querySelector("#category").value;
    let price = document.querySelector("#price").value;
    let stock = document.querySelector("#stock").value;

    if (!title) {
        alert("Insert the title of the product")
    } else {
        // Manejo errores por defecto desde aquí porque si no se pasan como arrays vacíos
        if (!photo) {
            photo = "/img/defaultProduct.png"
        }
        if (!category) {
            category = "product";
        }
        if (!price) {
            price = 1;
        }
        if (!stock) {
            stock = 1
        }
        socket.emit("product", {
            title,
            photo,
            category,
            price,
            stock
        });
    }
});
  //alerta por si el producto ya esta creado
  socket.on("alert", (message) => {
  alert(message);
});

  
</script>


  
